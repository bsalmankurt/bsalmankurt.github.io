<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Li-ion Kimyasal Enerji Yokuşu v3 - Görsel Efektler</title>
    <style>
        :root {
            --bg: #020617;
            --card: #0f172a;
            --primary: #6366f1;
            --ion: #22c55e;
            --electron: #ef4444;
            --text: #f8fafc;
            --accent: #fbbf24;
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
        }

        .dashboard {
            background: var(--card);
            padding: 2rem;
            border-radius: 32px;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.8);
            width: 900px;
            border: 1px solid #1e293b;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: rgba(255,255,255,0.03);
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            border: 1px solid #1e293b;
        }

        .v-main { font-size: 2.6rem; font-weight: 800; color: var(--accent); }
        .label { font-size: 0.75rem; color: #64748b; text-transform: uppercase; letter-spacing: 2px; }

        .progress-container {
            width: 100%; height: 8px; background: #020617;
            border-radius: 20px; margin-top: 15px; overflow: hidden;
            border: 1px solid #1e293b;
        }
        #p-bar {
            height: 100%; width: 0%; background: linear-gradient(90deg, #4f46e5, var(--ion));
            transition: width 0.4s ease;
        }

        .controls {
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(255,255,255,0.02); padding: 15px 30px;
            border-radius: 100px; margin-bottom: 25px;
        }

        .btn-group { display: flex; gap: 15px; }
        
        button {
            padding: 12px 28px; border: none; border-radius: 50px;
            font-weight: 700; cursor: pointer; transition: 0.3s;
            text-transform: uppercase; font-size: 0.8rem;
        }

        .btn-ch { background: var(--ion); color: #064e3b; }
        .btn-dch { background: var(--primary); color: white; }
        .btn-rs { background: #334155; color: white; }
        button:hover:not(:disabled) { transform: translateY(-2px); filter: brightness(1.2); }
        button:disabled { opacity: 0.2; cursor: not-allowed; }

        canvas { background: #020617; border-radius: 24px; border: 1px solid #1e293b; }
        .footer-desc { margin-top: 15px; font-size: 0.85rem; color: #94a3b8; text-align: center; line-height: 1.6; max-width: 800px; }
    </style>
</head>
<body>

    <div class="dashboard">
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="label">Şarj Akımı (Transfer)</div>
                <div style="font-size: 1.6rem; margin-top:5px; color: var(--primary);"><span id="inV">1.0</span>x</div>
            </div>
            
            <div class="metric-card" style="border-color: rgba(251, 191, 36, 0.2);">
                <div class="label">Elektrokimyasal Potansiyel</div>
                <div class="v-main"><span id="cellV">3.20</span><small style="font-size: 1rem;">V</small></div>
                <div class="progress-container"><div id="p-bar"></div></div>
            </div>

            <div class="metric-card">
                <div class="label">SoC (Doluluk Oranı)</div>
                <div style="font-size: 1.6rem; margin-top:5px; color: var(--ion);"><span id="soc">0</span>%</div>
            </div>
        </div>

        <div class="controls">
            <div style="display:flex; align-items:center; gap:20px;">
                <span class="label">Hız</span>
                <input type="range" id="vSlider" min="0.5" max="5" step="0.1" value="1" style="accent-color: var(--primary); width:150px;">
            </div>
            <div class="btn-group">
                <button id="chargeBtn" class="btn-ch">ŞARJ ET (Tepeye Çıkar)</button>
                <button id="dischargeBtn" class="btn-dch" disabled>DEŞARJ ET (Serbest Bırak)</button>
                <button id="resetBtn" class="btn-rs">SIFIRLA</button>
            </div>
        </div>

        <canvas id="simCanvas"></canvas>
        <div class="footer-desc">
            <b>Görsel İpucu:</b> Anot tarafındaki (sol, yüksekte) parçacıkların daha parlak ve geniş bir hal ile çizilmesi, onların <b>yüksek enerji durumunda</b> olduklarını ve iş yapmaya (deşarj olmaya) hazır olduklarını simgeler. Katot tarafındakiler ise enerjilerini kaybetmiş, sönük durumdadır.
        </div>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        const vSlider = document.getElementById('vSlider');
        
        canvas.width = 836;
        canvas.height = 420;

        let leftCount = 2;   
        let rightCount = 10; 
        const minReserve = 2;
        const maxCapacity = 10;

        let movingParticles = [];
        let voltageInput = 1.0;
        let currentMode = null;
        let currentAngle = 0.15; 

        const centerX = canvas.width / 2;
        const centerY = 260; 
        const beamLen = 480;

        class Particle {
            constructor(type, direction) {
                this.type = type;
                this.direction = direction; // -1: R->L (Şarj), 1: L->R (Deşarj)
                this.progress = 0;
                this.speed = (0.008 + Math.random() * 0.004) * voltageInput;
            }
            update() { this.progress += this.speed; return this.progress >= 1; }
            draw(angle) {
                const startSide = this.direction === -1 ? 1 : -1;
                const endSide = this.direction === -1 ? -1 : 1;
                const startPos = getPos(angle, startSide);
                const endPos = getPos(angle, endSide);
                const t = this.progress;
                
                const curveDepth = 120;
                const cpY = this.type === 'ion' ? centerY + curveDepth : centerY - curveDepth;
                
                const x = (1-t)**2 * startPos.x + 2*(1-t)*t * centerX + t**2 * endPos.x;
                const y = (1-t)**2 * startPos.y + 2*(1-t)*t * cpY + t**2 * endPos.y;
                
                // --- Dinamik Parlaklık Mantığı ---
                let currentBlur;
                const minBlur = 5; const maxBlur = 25;
                
                if (this.direction === -1) { 
                    // Şarj (Katot -> Anot): Parlaklık artar
                    currentBlur = minBlur + t * (maxBlur - minBlur);
                } else {
                    // Deşarj (Anot -> Katot): Parlaklık azalır
                    currentBlur = maxBlur - t * (maxBlur - minBlur);
                }

                ctx.beginPath(); ctx.arc(x, y, 6, 0, Math.PI*2);
                // Anota yaklaştıkça renkleri biraz daha açalım (brighter)
                const brightnessBoost = this.direction === -1 ? t * 40 : (1-t) * 40;
                
                if (this.type === 'ion') {
                    ctx.fillStyle = `rgb(${34+brightnessBoost}, ${197+brightnessBoost}, ${94+brightnessBoost})`; // #22c55e bazlı
                } else {
                    ctx.fillStyle = `rgb(${239+brightnessBoost}, ${68+brightnessBoost}, ${68+brightnessBoost})`; // #ef4444 bazlı
                }
                
                ctx.shadowBlur = currentBlur; ctx.shadowColor = ctx.fillStyle;
                ctx.fill(); ctx.shadowBlur = 0; // Reset
            }
        }

        function getPos(angle, side) {
            return {
                x: centerX + (side * (beamLen/2) * Math.cos(angle)),
                y: centerY + (side * (beamLen/2) * Math.sin(angle))
            };
        }

        function drawGradient(angle) {
            const left = getPos(angle, -1);
            const right = getPos(angle, 1);
            ctx.beginPath(); ctx.setLineDash([5, 10]); ctx.strokeStyle = 'rgba(99, 102, 241, 0.2)'; ctx.lineWidth = 2;
            ctx.moveTo(left.x, left.y); ctx.lineTo(right.x, right.y); ctx.stroke(); ctx.setLineDash([]);
        }

        function drawScale(angle) {
            const left = getPos(angle, -1);
            const right = getPos(angle, 1);
            
            ctx.strokeStyle = '#1e293b'; ctx.lineWidth = 6;
            ctx.beginPath(); ctx.moveTo(centerX, centerY); ctx.lineTo(centerX, canvas.height); ctx.stroke();
            
            ctx.lineWidth = 12; ctx.lineCap = 'round'; ctx.strokeStyle = '#f8fafc';
            ctx.beginPath(); ctx.moveTo(left.x, left.y); ctx.lineTo(right.x, right.y); ctx.stroke();

            drawPlate(left.x, left.y, leftCount, "ANOT (Yüksek Enerji)");
            drawPlate(right.x, right.y, rightCount, "KATOT (Düşük Enerji)");
        }

        function drawPlate(x, y, count, label) {
            const isAnot = label.includes("ANOT");
            
            // Kefe
            ctx.fillStyle = '#1e293b';
            ctx.beginPath(); ctx.roundRect(x - 70, y, 140, 12, 6); ctx.fill();
            
            // Etiket
            ctx.fillStyle = isAnot ? '#fbbf24' : '#64748b'; // Anot etiketi de parlasın
            ctx.font = 'bold 11px Inter'; ctx.textAlign = 'center';
            ctx.fillText(label, x, y + 40);
            
            // --- Parçacık Çizimi ve Halo Efekti ---
            const blurSize = isAnot ? 25 : 5; // Anot için büyük, Katot için küçük halo
            // Anot için daha parlak renkler
            const ionColor = isAnot ? '#4ade80' : '#22c55e'; 
            const electronColor = isAnot ? '#f87171' : '#ef4444';

            const displayCount = Math.floor(count);
            for(let i=0; i < displayCount; i++) {
                const r = Math.floor(i/4); const c = i % 4;
                const px = x - 45 + c*28; const py = y - 20 - r*18;
                
                // Li+
                ctx.beginPath(); ctx.arc(px, py, 6, 0, Math.PI*2);
                ctx.fillStyle = ionColor;
                ctx.shadowBlur = blurSize; ctx.shadowColor = ionColor;
                ctx.fill();
                
                // e-
                ctx.beginPath(); ctx.arc(px + 10, py, 4, 0, Math.PI*2);
                ctx.fillStyle = electronColor;
                ctx.shadowBlur = blurSize; ctx.shadowColor = electronColor;
                ctx.fill();
            }
            ctx.shadowBlur = 0; // Diğer çizimleri etkilememesi için sıfırla
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const targetAngle = 0.15 + (leftCount - 2) * 0.05; 
            currentAngle += (targetAngle - currentAngle) * 0.05; 
            
            drawGradient(currentAngle);
            drawScale(currentAngle);

            const soc = ((leftCount - minReserve) / (maxCapacity - minReserve)) * 100;
            const clampedSoC = Math.min(100, Math.max(0, soc));
            
            document.getElementById('cellV').innerText = (3.2 + (clampedSoC / 100)).toFixed(2);
            document.getElementById('soc').innerText = Math.round(clampedSoC);
            document.getElementById('p-bar').style.width = clampedSoC + "%";
            document.getElementById('inV').innerText = voltageInput.toFixed(1);

            if (!currentMode) {
                document.getElementById('chargeBtn').disabled = leftCount >= maxCapacity;
                document.getElementById('dischargeBtn').disabled = leftCount <= minReserve;
            } else {
                document.getElementById('chargeBtn').disabled = true;
                document.getElementById('dischargeBtn').disabled = true;
            }

            for (let i = movingParticles.length - 1; i >= 0; i--) {
                const p = movingParticles[i];
                if (p.update()) {
                    if (p.direction === -1) leftCount += 0.5; else rightCount += 0.5;
                    movingParticles.splice(i, 1);
                } else { 
                    p.draw(currentAngle); 
                }
            }
            requestAnimationFrame(animate);
        }

        function transfer() {
            if (currentMode === 'charge' && rightCount > minReserve) {
                movingParticles.push(new Particle('ion', -1), new Particle('electron', -1));
                rightCount--; 
                setTimeout(transfer, 800 / voltageInput);
            } else if (currentMode === 'discharge' && leftCount > minReserve) {
                movingParticles.push(new Particle('ion', 1), new Particle('electron', 1));
                leftCount--; 
                setTimeout(transfer, 800 / voltageInput);
            } else { 
                currentMode = null; 
            }
        }

        vSlider.oninput = (e) => voltageInput = parseFloat(e.target.value);
        document.getElementById('chargeBtn').onclick = () => { if(!currentMode) {currentMode='charge'; transfer();} };
        document.getElementById('dischargeBtn').onclick = () => { if(!currentMode) {currentMode='discharge'; transfer();} };
        document.getElementById('resetBtn').onclick = () => location.reload();
        
        animate();
    </script>
</body>
</html>